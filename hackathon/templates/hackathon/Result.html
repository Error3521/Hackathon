<!-- Ваш файл Result.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        .hidden {
            display: none;
        }

    </style>
</head>
<body>

<form enctype="multipart/form-data" method="post">
    {% csrf_token %}
    <input type="file" name="{{ form.file.name }}" id="{{ form.file.id_for_label }}" style="display: none;" onchange="displayFileName(this)">
    <button type="button" onclick="document.getElementById('{{ form.file.id_for_label }}').click();">Выбрать файл</button>
    <span id="fileNameDisplay" style="display: none;"></span>
    <button type="submit">Upload</button>
</form>

<script>
    function displayFileName(input) {
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const label = document.getElementById('fileLabel');

        if (input.files.length > 0) {
            fileNameDisplay.textContent = input.files[0].name;
            fileNameDisplay.style.display = 'inline';
            label.style.display = 'none';
        } else {
            fileNameDisplay.style.display = 'none';
            label.style.display = 'inline';
        }
    }
</script>



<!-- Отображение только вопроса и результата -->
<table class="hidden" id="resultTable">
    <thead>
    <tr>
        <th>Вопрос</th>
        <th>Result</th>
    </tr>
    </thead>
    <tbody>
    {% for question in questions %}
    <tr>
        <td>{{ question.question }}</td>
        <td>{{ question.result }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Отображение среднего результата -->
<p class="hidden" id="averageResult">Average Result: {{ avg_result }}</p>

<!-- Добавление кнопки Delete -->
<form action="{% url 'delete_data' %}" class="hidden" id="deleteDataForm" method="post">
    {% csrf_token %}
    <button onclick="deleteData()" type="button">Delete</button>
</form>

<!-- Отправляем запрос на сервер для удаления данных -->
<script>
    function deleteData() {
        fetch("{% url 'delete_data' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': "{{ csrf_token }}"
            },
        })
        .then(response => response.json())
        .then(data => {
            // Удаляем все строки из таблицы
            const table = document.getElementById('resultTable');
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            // Обновление среднего арифметического
            document.getElementById('averageResult').innerText = 'Average Result: ';

            // Показываем таблицу и среднее арифметическое
            table.classList.add('hidden');
            document.getElementById('averageResult').classList.add('hidden');
            document.getElementById('deleteDataForm').classList.add('hidden');

            alert(data.message);
        });
    }

</script>

<!-- Отправка запроса на генерацию результата -->
<form action="{% url 'generate_result' %}" id="generateResultForm" method="post">
    {% csrf_token %}
    <button onclick="generateResult()" type="button">Generate Result</button>
</form>

<script>
    function generateResult() {
        // Отправляем запрос на сервер для генерации результата
        fetch("{% url 'generate_result' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': "{{ csrf_token }}"
            },
        })
        .then(response => response.json())
        .then(data => {
            // Создаем и автоматически загружаем файл
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'result.json';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);

            // Показываем таблицу и среднее арифметическое после загрузки файла
            document.getElementById('resultTable').classList.remove('hidden');
            document.getElementById('averageResult').classList.remove('hidden');
            document.getElementById('deleteDataForm').classList.remove('hidden');
        });
    }

</script>

</body>
</html>
